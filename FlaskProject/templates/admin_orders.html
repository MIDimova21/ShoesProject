{% extends "base.html" %}

{% block link %}
<link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
{% endblock %}

{% block content %}
<div class="orders-container">
  <div class="orders-stats">
    <div class="stat-card">
      <div class="stat-label">–û–±—â–æ –ø–æ—Ä—ä—á–∫–∏</div>
      <div class="stat-value">{{ orders|length }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–û–±—â–∏ –ø—Ä–∏—Ö–æ–¥–∏</div>
      <div class="stat-value">{{ total_revenue }} –ª–≤</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–°—Ä–µ–¥–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç</div>
      <div class="stat-value">
        {% if orders|length > 0 %}
          {{ "%.2f"|format(total_revenue / orders|length) }} –ª–≤
        {% else %}
          0 –ª–≤
        {% endif %}
      </div>
    </div>
  </div>

  <div class="orders-table-wrapper">
    <div class="filter-section">
      <form method="GET" action="{{ url_for('admin.created_orders') }}" style="display: flex; gap: 15px; flex-wrap: wrap; width: 100%;">
        <input type="text" name="query" class="filter-input" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç..." value="{{ search_query or '' }}" style="flex: 2; min-width: 300px;">
        <button type="submit" class="export-btn" style="background: #9742b8;">–¢—ä—Ä—Å–∏</button>
      </form>
    </div>

    {% if orders %}

      <table class="orders-table" id="ordersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–ü—Ä–æ–¥—É–∫—Ç–∏</th>
            <th>–û–±—â–∞ —Å—É–º–∞</th>
            <th>–ü–ª–∞—â–∞–Ω–µ</th>
            <th>–ê–¥—Ä–µ—Å</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
            <tr>
              <td class="order-id">#{{ order.id }}</td>
              <td>
                <div class="customer-info">
                  <span class="customer-name">{{ order.user.first_name }} {{ order.user.last_name }}</span>
                  <span class="customer-email">{{ order.user.email }}</span>
                </div>
              </td>
              <td>
                <div class="order-items-list">
                  {% for item in order.items %}
                    <div class="order-item">
                      <div class="item-name">{{ item.product.name }}</div>
                      <div class="item-details">
                        –†–∞–∑–º–µ—Ä: {{ item.size }} | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ item.quantity }} | {{ item.price }} –ª–≤
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </td>
              <td class="order-total">
                {{ order_totals[order.id] }} –ª–≤
              </td>
              <td>
                {% if order.payment_method == "Credit Card" %}
                  <span class="payment-badge payment-card">üí≥ –î–µ–±–∏—Ç–Ω–∞ –∫–∞—Ä—Ç–∞</span>
                {% else %}
                  <span class="payment-badge payment-cod">üíµ –ù–∞–ª–æ–∂–µ–Ω –ø–ª–∞—Ç–µ–∂</span>
                {% endif %}
              </td>
              <td class="address-cell" title="{{ order.address }}">
                üìç {{ order.address }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="no-orders">
        <p>üì≠ –í—Å–µ –æ—â–µ –Ω—è–º–∞ –Ω–∞–ø—Ä–∞–≤–µ–Ω–∏ –ø–æ—Ä—ä—á–∫–∏</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}